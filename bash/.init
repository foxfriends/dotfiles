#!/bin/bash

[ ! -d "$HOME/bin" ] && mkdir "$HOME/bin"

if [ "$(uname)" == 'Darwin' ]; then 
  which gpg || brew install gpg
  which nvim || brew install neovim
  which ranger || brew install ranger
  which htop || brew install htop
  which autojump || brew install autojump
  which convert || brew install imagemagick
else
  which gpg || sudo apt install gpg
  which nvim || sudo apt install neovim
  which ranger || sudo apt install ranger
  which htop || sudo apt install htop
  which autojump || sudo apt install autojump
  which convert || sudo apt install imagemagick
fi 

if ! which diff-so-fancy ; then
  curl https://raw.githubusercontent.com/so-fancy/diff-so-fancy/master/third_party/build_fatpack/diff-so-fancy -o "$HOME/bin/diff-so-fancy"
  chmod a+x "$HOME/bin/diff-so-fancy"
  diff-so-fancy --set-defaults
fi

which kitty || (curl -L https://sw.kovidgoyal.net/kitty/installer.sh | sh /dev/stdin)
which fzf || (git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf && ~/.fzf/install)

if ! which asdf ; then
  git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.6.3
  [ -f "$HOME/.asdf/asdf.sh" ] && . "$HOME/.asdf/asdf.sh"
  [ -f "$HOME/.asdf/asdf.sh" ] && . "$HOME/.asdf/completions/asdf.bash"

  asdf plugin-add golang
  asdf plugin-add haskell
  asdf plugin-add io
  asdf plugin-add java
  asdf plugin-add nodejs
  asdf plugin-add python
  asdf plugin-add ruby
  asdf plugin-add scala

  # Get NodeJS installed right away because I use it more often than the rest
  ~/.asdf/plugins/nodejs/bin/import-release-team-keyring
  asdf install nodejs 11.9.0
  asdf global nodejs 11.9.0
  npm i -g npm fx undollar
fi

which rustup || (curl https://sh.rustup.rs -sSf | sh)
which exa || cargo install exa
which rls || cargo install rls
which tldr || cargo install tealdeer
which hexyl || cargo install hexyl
which hyperfine || cargo install hyperfine

if [ ! -d "$HOME/.config/kitty/.git" ]; then
  rm -r "$HOME/.config/kitty"
  git clone git@github.com:oinkiguana/config --branch kitty "$HOME/.config/kitty"
fi

if [ ! -d "$HOME/.config/nvim/.git" ]; then
  rm -r "$HOME/.config/nvim"
  git clone git@github.com:oinkiguana/config --branch nvim "$HOME/.config/nvim"
fi

if [ ! -d "$HOME/.config/ranger/.git" ]; then
  rm -r "$HOME/.config/ranger"
  git clone git@github.com:oinkiguana/config --branch ranger "$HOME/.config/ranger"
fi
